---
# Petunka Holdings AWS Organization Configuration - Environment Templated
# Email addresses are dynamically generated based on environment in Terraform

metadata:
  name: "petunka-holdings"
  description: "Petunka Holdings Inc AWS Organization"
  version: "1.0.0"

# Temporarily disable policy creation to avoid conflicts with existing policies
force_scp_creation: false
force_tag_policy_creation: false

environments:
  dev:
    target: localstack
    endpoint: http://localhost:4566
    region: us-east-1
    profile: null
    
  qa:
    target: aws
    profile: petunka-sandbox-mgmt-admin
    region: us-west-2
    
  prod:
    target: aws
    profile: petunka-prod-admin
    region: us-west-2

organization:
  feature_set: ALL
  default_region: us-west-2
  allowed_regions: [us-west-2, us-east-1]
  service_access_principals:
    - cloudtrail.amazonaws.com
    - guardduty.amazonaws.com
    - securityhub.amazonaws.com
    - sso.amazonaws.com

organizational_units:
  - name: Security
    description: Security and compliance accounts
    
  - name: SharedServices
    description: Shared infrastructure and services
    
  - name: Businesses
    description: Business entity accounts
    
  - name: Sandbox
    description: Development and testing accounts

# Base account configuration - emails will be templated by Terraform based on environment
accounts:
  - name: log-archive
    email_template: "aws-root+{env}-log-archive@petunkaholdings.com"
    ou: Security
    description: Centralized log archive for CloudTrail and security logs
    
  - name: security-tooling
    email_template: "aws-root+{env}-security-tooling@petunkaholdings.com"
    ou: Security
    description: Security tooling, GuardDuty, Security Hub
    
  - name: shared-services
    email_template: "aws-root+{env}-shared-services@petunkaholdings.com"
    ou: SharedServices
    description: Shared DNS, networking, CI/CD infrastructure
    
  - name: petunka-holdings-inc
    email_template: "aws-root+{env}@petunkaholdings.com"
    ou: Businesses
    description: Parent holding company - Petunka Holdings Inc
    
  - name: petunka-marketing-llc
    email_template: "aws-root+{env}-marketing@petunkaholdings.com"
    ou: Businesses
    description: Marketing subsidiary - Petunka Marketing LLC
    
  - name: internet-marketing-gold
    email_template: "aws-root+{env}-img@petunkaholdings.com"
    ou: Businesses
    description: Sub-brand under Petunka Marketing LLC - Internet Marketing Gold
    
  - name: six-figure-coach-secrets-llc
    email_template: "aws-root+{env}@sixfigurecoachsecrets.com"
    ou: Businesses
    description: Coaching business subsidiary - Six Figure Coach Secrets LLC
    
  - name: sandboxes
    email_template: "aws-root+{env}-sandboxes@petunkaholdings.com"
    ou: Sandbox
    description: Development and experimental workloads

policies:
  tag_policies:
    - name: PetunkaHoldingsStandardTags
      description: Standard tagging policy for Petunka Holdings organization
      required_tags:
        - Environment
        - BusinessUnit
        - CostCenter
        - Owner
      tag_values:
        Environment: [dev, staging, qa, prod, sandbox]
        BusinessUnit: [holdings, marketing, coaching, shared-services, security]
        
  service_control_policies:
    - name: baseline_security
      description: Baseline security restrictions
      policies:
        - prevent_org_changes
        - region_restrictions
        - prevent_public_s3

sso:
  enabled: true
  
  permission_sets:
    - name: PowerUser
      description: Power user access for elevated operations
      managed_policies:
        - arn:aws:iam::aws:policy/PowerUserAccess
      session_duration: PT12H
      
    - name: ReadOnly
      description: Read-only access for auditors and viewers
      managed_policies:
        - arn:aws:iam::aws:policy/ReadOnlyAccess
      session_duration: PT8H
      
    - name: SecurityAuditor
      description: Security auditing and compliance access
      managed_policies:
        - arn:aws:iam::aws:policy/SecurityAudit
        - arn:aws:iam::aws:policy/ReadOnlyAccess
      session_duration: PT8H
      
    - name: Billing
      description: Billing and cost management access
      managed_policies:
        - arn:aws:iam::aws:policy/job-function/Billing
      session_duration: PT4H
      
    - name: OrganizationAdmin
      description: Organization administration access
      managed_policies:
        - arn:aws:iam::aws:policy/AWSOrganizationsFullAccess
      session_duration: PT4H

  group_assignments:
    - group_name: Engineers
      permission_set: PowerUser
      accounts: [petunka-holdings-inc, petunka-marketing-llc, internet-marketing-gold, six-figure-coach-secrets-llc]
      
    - group_name: Administrators
      permission_set: PowerUser
      accounts: [log-archive, security-tooling, shared-services, petunka-holdings-inc, petunka-marketing-llc, internet-marketing-gold, six-figure-coach-secrets-llc, sandboxes]
      
    - group_name: Finance
      permission_set: Billing
      accounts: [management]
      
    - group_name: Security
      permission_set: SecurityAuditor
      accounts: [log-archive, security-tooling, shared-services, petunka-holdings-inc, petunka-marketing-llc, internet-marketing-gold, six-figure-coach-secrets-llc, sandboxes]

github_actions:
  enabled: true
  
  repositories:
    - repo: petunka-holdings/infrastructure
      environments: [dev, qa, prod]
      
    - repo: petunka-holdings/marketing-platform
      environments: [dev, qa, prod]
      
    - repo: petunka-holdings/coaching-platform
      environments: [dev, qa, prod]
      
  permissions:
    dev:
      accounts: [sandboxes, shared-services]
      policies: [arn:aws:iam::aws:policy/PowerUserAccess]
      
    qa:
      accounts: [petunka-holdings-inc, shared-services]
      policies: [arn:aws:iam::aws:policy/PowerUserAccess]
      
    prod:
      accounts: [petunka-holdings-inc, petunka-marketing-llc, internet-marketing-gold, six-figure-coach-secrets-llc]
      policies: [arn:aws:iam::aws:policy/ReadOnlyAccess]

security:
  cloudtrail:
    enabled: true
    multi_region: true
    include_global_service_events: true
    enable_log_file_validation: true
    log_retention_days: 365
    
  guardduty:
    enabled: true
    auto_enable_organization_members: true
    
  security_hub:
    enabled: true
    auto_enable_organization_members: true
    standards:
      - aws-foundational-security-best-practices
      - cis-aws-foundations-benchmark

cost_management:
  budgets:
    - name: "petunka-monthly-budget"  # This will be templated in Terraform
      limit_template: "{env == 'prod' ? 5000 : 2000}"  # Conditional logic for Terraform
      unit: USD
      time_period: MONTHLY
      alerts:
        - threshold: 80
          notification_emails: [finance@petunkaholdings.com]
        - threshold: 100
          notification_emails: [finance@petunkaholdings.com, admin@petunkaholdings.com]
